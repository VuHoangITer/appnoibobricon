<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Lương - {{ salary.employee_name }}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        @media print {
            .alert, .btn, .no-print {
                display: none !important;
            }
            body {
                padding: 0 !important;
            }
        }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <!-- Warning Banner -->
        {% if is_last_view %}
        <div class="alert alert-danger mb-4 no-print">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-octagon-fill me-3" style="font-size: 2rem;"></i>
                <div class="flex-grow-1">
                    <h5 class="mb-1">⚠️ Đây là lượt xem cuối cùng!</h5>
                    <p class="mb-0">
                        Link này đã hết lượt xem và <strong>đã bị xóa tự động</strong>.
                        <br>Vui lòng lưu hoặc in bảng lương này ngay nếu bạn cần.
                    </p>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-warning mb-4 no-print">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 2rem;"></i>
                <div class="flex-grow-1">
                    <h5 class="mb-1">Link chia sẻ có thời hạn</h5>
                    <p class="mb-0">
                        <i class="bi bi-clock"></i> Link này sẽ hết hạn sau <strong>{{ hours_left }} giờ</strong>
                        {% if share_link.max_views %}
                        <br><i class="bi bi-eye"></i> Lượt xem: <strong>{{ share_link.view_count }}/{{ share_link.max_views }}</strong>
                        {% if share_link.view_count == share_link.max_views - 1 %}
                        <br><span class="text-danger"><strong>⚠️ Còn 1 lượt xem cuối!</strong></span>
                        {% endif %}
                        {% else %}
                        <br><i class="bi bi-eye"></i> Đã xem: <strong>{{ share_link.view_count }}</strong> lần
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Salary Content -->
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="bi bi-file-earmark-text"></i>
                    Phiếu Lương - {{ salary.employee_name }}
                </h4>
                <small>Tháng {{ salary.month }}</small>
            </div>
            <div class="card-body">
                <!-- Thông tin nhân viên -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong><i class="bi bi-person-badge"></i> Nhân viên:</strong> {{ salary.employee_name }}</p>
                        <p><strong><i class="bi bi-calendar"></i> Tháng:</strong> {{ salary.month }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong><i class="bi bi-calendar-check"></i> Số ngày quy định:</strong> {{ salary.work_days_in_month }} ngày</p>
                        <p><strong><i class="bi bi-calendar2-check"></i> Số công thực tế:</strong> {{ salary.actual_work_days }} ngày</p>
                    </div>
                </div>

                <!-- Chi tiết tính lương -->
                <h5 class="mb-3"><i class="bi bi-calculator"></i> Chi tiết tính lương</h5>
                <table class="table table-borderless">
                    <tr>
                        <td width="60%"><strong>Lương cơ bản/tháng:</strong></td>
                        <td class="text-end">{{ "{:,.0f}".format(salary.basic_salary) }} ₫</td>
                    </tr>
                    <tr>
                        <td><strong>Lương trách nhiệm/tháng:</strong></td>
                        <td class="text-end">{{ "{:,.0f}".format(salary.responsibility_salary) }} ₫</td>
                    </tr>
                    <tr class="table-light">
                        <td>Lương cơ bản/ngày:</td>
                        <td class="text-end">{{ "{:,.0f}".format(salary.basic_salary_per_day) }} ₫</td>
                    </tr>
                    <tr class="table-light">
                        <td>Lương trách nhiệm/ngày:</td>
                        <td class="text-end">{{ "{:,.0f}".format(salary.responsibility_salary_per_day) }} ₫</td>
                    </tr>
                    <tr class="table-primary">
                        <td><strong>Lương chính ({{ salary.actual_work_days }} ngày):</strong></td>
                        <td class="text-end"><strong>{{ "{:,.0f}".format(salary.main_salary) }} ₫</strong></td>
                    </tr>
                </table>

                <!-- Lương năng lực -->
                {% set capacity_bonuses = salary.get_capacity_bonuses() %}
                {% if capacity_bonuses %}
                <h5 class="mb-3 mt-4"><i class="bi bi-award"></i> Lương năng lực</h5>
                <table class="table table-borderless">
                    {% for bonus in capacity_bonuses %}
                    <tr>
                        <td width="60%">{{ bonus.content }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(bonus.amount) }} ₫</td>
                    </tr>
                    {% endfor %}
                    <tr class="table-success">
                        <td><strong>Tổng lương năng lực:</strong></td>
                        <td class="text-end"><strong>{{ "{:,.0f}".format(salary.total_capacity_bonus) }} ₫</strong></td>
                    </tr>
                </table>
                {% endif %}

                <!-- Các khoản khấu trừ -->
                {% set deductions = salary.get_deductions() %}
                {% if deductions %}
                <h5 class="mb-3 mt-4"><i class="bi bi-dash-circle"></i> Các khoản khấu trừ</h5>
                <table class="table table-borderless">
                    {% for deduction in deductions %}
                    <tr>
                        <td width="60%">{{ deduction.content }}</td>
                        <td class="text-end text-danger">-{{ "{:,.0f}".format(deduction.amount) }} ₫</td>
                    </tr>
                    {% endfor %}
                    <tr class="table-warning">
                        <td><strong>Tổng khấu trừ:</strong></td>
                        <td class="text-end text-danger"><strong>-{{ "{:,.0f}".format(salary.total_deduction) }} ₫</strong></td>
                    </tr>
                </table>
                {% endif %}

                <!-- Kết quả cuối cùng -->
                <div class="card bg-light mt-4">
                    <div class="card-body">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td width="60%"><h5><i class="bi bi-cash-stack"></i> Tổng thu nhập:</h5></td>
                                <td class="text-end"><h5 class="text-info">{{ "{:,.0f}".format(salary.total_income) }} ₫</h5></td>
                            </tr>
                            <tr>
                                <td><h5><i class="bi bi-dash-circle-fill"></i> Tổng khấu trừ:</h5></td>
                                <td class="text-end"><h5 class="text-danger">-{{ "{:,.0f}".format(salary.total_deduction) }} ₫</h5></td>
                            </tr>
                            <tr style="border-top: 3px solid #198754;">
                                <td><h4 class="text-success"><strong><i class="bi bi-cash-coin"></i> LƯƠNG THỰC LĨNH:</strong></h4></td>
                                <td class="text-end"><h3 class="text-success mb-0"><strong>{{ "{:,.0f}".format(salary.net_salary) }} ₫</strong></h3></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Print Button -->
                <div class="mt-4 text-center no-print">
                    <button onclick="window.print()" class="btn btn-primary btn-lg">
                        <i class="bi bi-printer"></i> In bảng lương
                    </button>
                </div>
            </div>
        </div>

        <!-- Security Notice -->
        <div class="alert alert-info mt-4 no-print">
            <i class="bi bi-shield-check"></i>
            <strong>Lưu ý bảo mật:</strong> Đây là link chia sẻ tạm thời. Vui lòng không chia sẻ link này với người khác.
        </div>
    </div>
</body>
</html>